<!doctype html>
<html lang="ja">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+JP:wght@100..900&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>新年カウントダウン</title>
	<style>

        h1{
            text-align: center;
        }
        .countdown{
            display: flex;
            justify-content: center;
            font-size: 220px;
            align-items: center;
            height: 80vh;
        }
			.countdown{
				display: flex;
				justify-content: center;
				align-items: center;
				flex-wrap: wrap;
				gap: 0.2em;
				min-height: 60vh;
				padding: 1rem 0.5rem;
			}
			/* responsive size: between 64px and 220px depending on viewport */
			:root{--countdown-size: clamp(64px, 18vw, 220px)}
			.num{
				font-family: "DotGothic16", sans-serif;
				font-size: var(--countdown-size);
				line-height: 1;
				white-space: nowrap;
        }
			.label{
				font-family: "Silkscreen", sans-serif;
				font-size: calc(var(--countdown-size) * 0.75);
				line-height: 1;
				padding: 0 0.08em;
        }
	</style>
</head>
<body>
	<div class="wrap">
		<div class="card">
			<h1 id="title">新年まであと</h1>
			<div id="countdown" class="countdown" aria-live="polite">
				<div id="days" class="num">0</div><div class="label">:</div>
				<div id="hours" class="num">00</div><div class="label">:</div>
				<div id="minutes" class="num">00</div><div class="label">:</div>
				<div id="seconds" class="num">00</div><div class="label"></div>
			</div> 

			<div id="message" style="text-align:center; font-size:36px; margin-top:10px;"></div>
			</div>
	</div>

	<script>
		function pad(n){return n.toString().padStart(2,'0')}

		function getNextNewYear(now){
			const year = now.getFullYear();
			// 1月1日 00:00:00 of next calendar year
			return new Date(year + 1, 0, 1, 0, 0, 0);
		}

		function update(){
			const now = new Date();
			const title = document.getElementById('title');

			// If it's already New Year's Day (anytime on Jan 1), show greeting immediately
			if(now.getMonth() === 0 && now.getDate() === 1){
				if(title) title.style.display = 'none';
				document.getElementById('countdown').style.display = 'none';
				const msg = document.getElementById('message');
				msg.textContent = 'あけましておめでとうございます！';
				launchConfetti();
				clearInterval(timer);
				return;
			}

			const target = getNextNewYear(now);
			const diff = target - now;

			if(diff <= 0){
				if(title) title.style.display = 'none';
				document.getElementById('countdown').style.display = 'none';
				const msg = document.getElementById('message');
				msg.textContent = 'あけましておめでとうございます！';
				launchConfetti();
				clearInterval(timer);
				return;
			}

			// Normal countdown state: ensure title is visible
			if(title){
				title.style.display = '';
				title.textContent = '新年まであと';
			}

			const sec = Math.floor(diff / 1000) % 60;
			const min = Math.floor(diff / (1000*60)) % 60;
			const hrs = Math.floor(diff / (1000*60*60)) % 24;
			const days = Math.floor(diff / (1000*60*60*24));

			document.getElementById('days').textContent = days;
			document.getElementById('hours').textContent = pad(hrs);
			document.getElementById('minutes').textContent = pad(min);
			document.getElementById('seconds').textContent = pad(sec);
		}

		// simple confetti (no external libs)
		function launchConfetti(){
			const colors = ['#ff595e','#ffca3a','#8ac926','#1982c4','#6a4c93'];
			const count = 120;
			for(let i=0;i<count;i++){
				const el = document.createElement('div');
				el.className = 'confetti';
				el.style.background = colors[Math.floor(Math.random()*colors.length)];
				el.style.left = Math.random()*100 + '%';
				el.style.top = '-10px';
				el.style.transform = 'rotate(' + (Math.random()*360) + 'deg)';
				el.style.opacity = (0.6 + Math.random()*0.4).toString();
				document.body.appendChild(el);

				const fall = 2000 + Math.random()*3000;
				el.animate([
					{transform: el.style.transform, top: '-10px', opacity: el.style.opacity},
					{transform: 'translateY(' + (window.innerHeight + 200) + 'px) rotate(' + (Math.random()*720) + 'deg)', top: (window.innerHeight + 200) + 'px', opacity: 0.9}
				], {duration: fall, easing: 'cubic-bezier(.2,.7,.3,1)'});

				setTimeout(()=>{ el.remove(); }, fall + 500);
			}
		}

		const timer = setInterval(update, 1000);
		update();
	</script>
</body>
</html>

